# Migration `20201122153618-init`

This migration has been generated by Leonardo Petrucci at 11/22/2020, 3:36:18 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Server" (
"id" SERIAL,
    "title" TEXT NOT NULL,
    "content" TEXT,
    "published" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "cover" TEXT,
    "slots" INTEGER NOT NULL,
    "ip" TEXT NOT NULL DEFAULT E'',
    "authorId" INTEGER NOT NULL,
    "versionId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
    "id" INTEGER NOT NULL,
    "email" TEXT NOT NULL,
    "username" TEXT NOT NULL,
    "role" TEXT NOT NULL,
    "photoUrl" TEXT NOT NULL DEFAULT E'',
    "posts" INTEGER NOT NULL DEFAULT 0,
    "banned" BOOLEAN NOT NULL DEFAULT false,

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
"id" SERIAL,
    "tagName" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Vote" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "authorId" INTEGER NOT NULL,
    "serverId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Version" (
"id" SERIAL,
    "versionName" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_ServerToTag" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Tag.tagName_unique" ON "Tag"("tagName")

CREATE UNIQUE INDEX "Version.versionName_unique" ON "Version"("versionName")

CREATE UNIQUE INDEX "_ServerToTag_AB_unique" ON "_ServerToTag"("A", "B")

CREATE INDEX "_ServerToTag_B_index" ON "_ServerToTag"("B")

ALTER TABLE "Server" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Server" ADD FOREIGN KEY("versionId")REFERENCES "Version"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Vote" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Vote" ADD FOREIGN KEY("serverId")REFERENCES "Server"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ServerToTag" ADD FOREIGN KEY("A")REFERENCES "Server"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ServerToTag" ADD FOREIGN KEY("B")REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201122153618-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,58 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgres"
+  url = "***"
+}
+
+model Server {
+  id        Int     @default(autoincrement()) @id
+  title     String
+  content   String?
+  published Boolean @default(false)
+  createdAt DateTime @default(now())
+  cover     String?
+  slots     Int
+  ip        String  @default("")
+  author    User    @relation(fields: [authorId], references: [id])
+  authorId  Int
+  version   Version @relation(fields: [versionId], references: [id])
+  versionId Int
+  tags      Tag[]
+  votes     Vote[]
+}
+
+model User {
+  id       Int      @id
+  email    String   @unique
+  username String
+  role     String
+  photoUrl String   @default("")
+  posts    Int      @default(0)
+  banned   Boolean  @default(false)
+  Votes    Vote[]
+  Servers  Server[]
+}
+
+model Tag {
+  id      Int      @default(autoincrement()) @id
+  tagName String   @unique
+  Servers Server[]
+}
+
+model Vote {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  authorId  Int
+  serverId  Int
+  author    User     @relation(fields: [authorId], references: [id])
+  server    Server   @relation(fields: [serverId], references: [id])
+}
+
+model Version {
+  id          Int      @default(autoincrement()) @id
+  versionName String   @unique
+  Servers     Server[]
+}
```


